{% comment %}
  VersaCommerce Featured Products Section
{% endcomment %}

{% liquid
  assign title = section.settings.title | default: 'Featured Products'
  assign subtitle = section.settings.subtitle | default: 'Best Sellers'
  assign selected_collection = collections[section.settings.collection]
  assign collection = selected_collection | default: collections.all
  assign products_limit = section.settings.products_limit | default: 8
  assign show_view_all = section.settings.show_view_all | default: true
  assign view_all_url = section.settings.view_all_url | default: routes.all_products_collection_url
%}

{% capture product_grid_props %}
{
  "title": {{ title | json }},
  "subtitle": {{ subtitle | json }},
  "products_limit": {{ products_limit | json }},
  "show_view_all": {{ show_view_all | json }},
  "view_all_url": {{ view_all_url | json }},
  "collection_handle": {{ collection.handle | json }}
}
{% endcapture %}

{% render 'react-component', component: 'VersaProductGrid', props: product_grid_props %}
    
    {% if section.settings.show_view_all and collection.products.size > 0 %}
      <div class="text-center mt-12">
        {% liquid
          assign view_all_url = section.settings.view_all_url
          unless view_all_url
            if selected_collection
              assign view_all_url = selected_collection.url
            else
              assign view_all_url = routes.all_products_collection_url
            endif
          endunless
        %}
        <a href="{{ view_all_url }}" class="btn btn-outline">
          {% if selected_collection %}View All {{ selected_collection.title }}{% else %}View All Products{% endif %}
        </a>
      </div>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Versa Product Grid",
  "tag": "section",
  "class": "versa-product-grid",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Featured Products"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Section Subtitle",
      "default": "Best Sellers"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select a collection to display products from. Leave empty to show all products."
    },
    {
      "type": "range",
      "id": "products_limit",
      "label": "Number of products",
      "min": 4,
      "max": 12,
      "step": 4,
      "default": 8
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show 'View All' button",
      "default": true
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "'View All' button URL",
      "default": "/collections/all"
    }
  ],
  "presets": [
    {
      "name": "Versa Product Grid"
    }
  ]
}
{% endschema %}
