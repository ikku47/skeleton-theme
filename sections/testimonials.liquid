{% comment %}
  VersaCommerce Testimonials - Carousel or 2-column quote grid
{% endcomment %}

{% liquid
  assign title = section.settings.title | default: 'What Our Customers Say'
  assign subtitle = section.settings.subtitle | default: 'Testimonials'
  assign layout = section.settings.layout | default: 'carousel'
  assign auto_play = section.settings.auto_play | default: true
  assign auto_play_interval = section.settings.auto_play_interval | default: 5000
  assign testimonials = section.blocks | where: 'type', 'testimonial'
%}

{% if testimonials.size > 0 %}
  {% capture testimonials_json %}
  [
    {% for block in testimonials %}
      {
        "id": {{ block.id | json }},
        "name": {{ block.settings.name | json }},
        {% if block.settings.role != blank %}"role": {{ block.settings.role | json }},{% endif %}
        {% if block.settings.avatar %}"avatar": {{ block.settings.avatar | image_url: width: 100, height: 100 | json }},{% endif %}
        "rating": {{ block.settings.rating | json }},
        "content": {{ block.settings.content | json }}
        {% if block.settings.location != blank %},"location": {{ block.settings.location | json }}{% endif %}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
  {% endcapture %}

  {% capture testimonials_props %}
  {
    "title": {{ title | json }},
    "subtitle": {{ subtitle | json }},
    "testimonials": {{ testimonials_json | strip }},
    "layout": {{ layout | json }},
    "autoPlay": {{ auto_play | json }},
    "autoPlayInterval": {{ auto_play_interval | json }}
  }
  {% endcapture %}

  {% render 'react-component', component: 'TestimonialsSection', props: testimonials_props %}
{% endif %}

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "testimonials-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "What Our Customers Say"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Section Subtitle",
      "default": "Testimonials"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "carousel",
          "label": "Carousel"
        },
        {
          "value": "grid",
          "label": "Grid (2 columns)"
        }
      ],
      "default": "carousel"
    },
    {
      "type": "header",
      "content": "Carousel Settings"
    },
    {
      "type": "checkbox",
      "id": "auto_play",
      "label": "Auto-play carousel",
      "default": true,
      "info": "Only applies to carousel layout"
    },
    {
      "type": "range",
      "id": "auto_play_interval",
      "label": "Auto-play interval (milliseconds)",
      "min": 3000,
      "max": 9000,
      "step": 1000,
      "default": 5000,
      "info": "Only applies to carousel layout with auto-play enabled"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Customer Name",
          "default": "Customer Name"
        },
        {
          "type": "text",
          "id": "role",
          "label": "Role/Title",
          "info": "Optional, e.g., 'Verified Customer'"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Customer Photo",
          "info": "Optional customer photo"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "textarea",
          "id": "content",
          "label": "Testimonial Content",
          "default": "This product exceeded my expectations! Great quality and excellent customer service."
        },
        {
          "type": "text",
          "id": "location",
          "label": "Location",
          "info": "Optional, e.g., 'New York, NY'"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "name": "Sarah Johnson",
            "role": "Verified Customer",
            "rating": 5,
            "content": "Amazing quality and fast shipping! The product exceeded my expectations and the customer service was outstanding.",
            "location": "New York, NY"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Michael Chen",
            "role": "Verified Customer",
            "rating": 5,
            "content": "I have been shopping here for months and every purchase has been perfect. Highly recommend to anyone looking for quality products.",
            "location": "Los Angeles, CA"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Emily Rodriguez",
            "role": "Verified Customer",
            "rating": 5,
            "content": "The best online shopping experience I have had. Great products, easy checkout, and excellent customer support.",
            "location": "Miami, FL"
          }
        }
      ]
    }
  ]
}
{% endschema %}
