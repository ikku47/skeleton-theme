{% comment %}
  Testimonials Section with React component integration
  Features: Customer reviews, ratings, avatars
{% endcomment %}

{% liquid
  assign title = section.settings.title | default: 'What Our Customers Say'
  assign subtitle = section.settings.subtitle | default: 'Real reviews from real customers'
%}

{% capture testimonials_props %}
{
  "title": "{{ title | escape }}",
  "subtitle": "{{ subtitle | escape }}",
  "testimonials": [
    {% for block in section.blocks %}
      {% if block.type == 'testimonial' %}
        {
          "id": "{{ block.id }}",
          "name": "{{ block.settings.name | escape }}",
          {% if block.settings.role != blank %}
          "role": "{{ block.settings.role | escape }}",
          {% endif %}
          {% if block.settings.avatar %}
          "avatar": "{{ block.settings.avatar | image_url: width: 80, height: 80 }}",
          {% endif %}
          "content": "{{ block.settings.content | escape }}",
          "rating": {{ block.settings.rating | default: 5 }}
          {% if block.settings.product != blank %}
          ,"product": "{{ block.settings.product | escape }}"
          {% endif %}
        }{% unless forloop.last %},{% endunless %}
      {% endif %}
    {% endfor %}
  ]
}
{% endcapture %}

{% render 'react-component', component: 'TestimonialsSection', props: testimonials_props %}

{% schema %}
{
  "name": "Testimonials",
  "tag": "section",
  "class": "testimonials-section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "What Our Customers Say"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Section Subtitle",
      "default": "Real reviews from real customers"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Customer Name"
        },
        {
          "type": "text",
          "id": "role",
          "label": "Role/Title (optional)"
        },
        {
          "type": "image_picker",
          "id": "avatar",
          "label": "Customer Avatar (optional)"
        },
        {
          "type": "textarea",
          "id": "content",
          "label": "Review Content"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "Rating",
          "min": 1,
          "max": 5,
          "step": 1,
          "default": 5
        },
        {
          "type": "text",
          "id": "product",
          "label": "Product Name (optional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonials",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "name": "Sarah Johnson",
            "role": "Verified Customer",
            "content": "Amazing quality and fast shipping! The product exceeded my expectations and the customer service was outstanding.",
            "rating": 5,
            "product": "Premium Collection"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Michael Chen",
            "role": "Repeat Customer",
            "content": "I've been shopping here for over a year and they never disappoint. Great products, great prices, great service!",
            "rating": 5
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Emma Davis",
            "role": "Fashion Blogger",
            "content": "This store has become my go-to for unique pieces. The quality is consistently excellent and the style is always on-trend.",
            "rating": 5
          }
        }
      ]
    }
  ]
}
{% endschema %}
